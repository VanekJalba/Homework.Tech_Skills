/* ---------------------------JQUERY--------------------------- */
//= partials/_jquery.js
/* ---------------------------JCAROUSEL--------------------------- */
;
//= partials/_jquery.jcarousel.js
;
//= partials/_jcarousel.js
;
/* ---------------------------Masonry--------------------------- */
//= partials/_masonry.pkgd.js
;
/* ---------------------------Template--------------------------- */
//= partials/_microTemplates.js
;
$(function () {
  var isActive = false;
  var getData = function (q) {
    var API_KEY = '2656466-4e611d876bc99286937427964';
      var URL = "http://pixabay.com/api/?key="+API_KEY+"&response_group=image_details"+"&per_page=10"+"&q="+encodeURIComponent(q);
      // (1)
      var XHR = ("onload" in new XMLHttpRequest()) ? XMLHttpRequest : XDomainRequest;
      var xhr = new XHR();
      // (2) запрос на другой домен :)
      xhr.open('GET', URL, true);
      xhr.onload = function() {
        // alert(this.responseText);
            // activityGridInit();
            if (parseInt(JSON.parse(this.responseText).totalHits) > 0) {
                // alert (data);
                activityGridInit(JSON.parse(this.responseText));
              } else {
                console.log('No hits');
              }
        // console.log(JSON.parse(this.responseText));
        // console.log(this);
      }
      xhr.onerror = function() {
      alert( 'Ошибка ' + this.status );
      }
      xhr.send();
      // $.getJSON(URL).success(function (data) {
      //   if (parseInt(data.totalHits) > 0) {
      //     alert (data);
      //     activityGridInit(data);
      //   } else {
      //     console.log('No hits');
      //   }
      // })
  }
  var activityGridInit = function (dataImg) {
    if (isActive === true) {
      // msnry.destroy();
      $('.activity__grid').masonry('destroy');
      // console.log('masonry destroyed');
    };
    var activityGridTmpl = $('#activity__grid__template').html();
    var activityGridHtml = tmpl(activityGridTmpl, {dataImg: dataImg});
    $('.activity__grid').html(activityGridHtml);
// var elem = document.querySelector('.activity__grid');
// var msnry = new Masonry( elem, {
//   // options
//   itemSelector: '.activity__grid-item',
//   columnWidth: '.activity__grid__sizer'
//   // columnWidth: 200
// });
// $('.activity__grid').isotope({
// // options
// itemSelector: '.activity__grid__item',
// percentPosition: true,
// masonry: {
//     // use element for option
//     columnWidth: '.activity__grid__sizer'
//   }
// layoutMode: 'fitRows'
// });


    $('.activity__grid').masonry({
    itemSelector: '.activity__grid__item',
    columnWidth: '.activity__grid__sizer'
    });
    isActive = true;
  }

  var reloadImg = function (e) {
    e.preventDefault();
    var query = searchInput.val();
    if (query.length === 0) {
      return;
    }
    getData(query);
  }
  var searchBtn = $('.activity__box__search__form__submit');
  var searchInput = $('.activity__box__search__form__input');
  searchBtn.click(reloadImg);

  var data2 = localStorage.getItem('data');
  var dataImg = JSON.parse(data2);
  // console.log('dataImg', dataImg);
  // activityGridInit(dataImg);
  // $('.activity__grid').isotope({
  // // options
  // itemSelector: '.activity__grid__item',
  // percentPosition: true,
  // masonry: {
  //     // use element for option
  //     columnWidth: '.activity__grid__sizer'
  //   }
  // // layoutMode: 'fitRows'
  // });
  $('.activity__grid').masonry({
  itemSelector: '.activity__grid__item',
  columnWidth: '.activity__grid__sizer'
  });
  isActive = true;
  getData('');
})
